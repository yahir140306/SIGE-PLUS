---
import ReinscripcionLayout from "../../layouts/ReinscripcionLayout.astro";
import Stepper from "../../components/Stepper.astro";
---

<ReinscripcionLayout title="UTSH - Reinscripción Paso 1">
  <main class="flex-grow flex flex-col items-center justify-start py-10 px-4">
    <div class="w-full max-w-3xl">
      <Stepper currentStep={1} />

      <!-- Alert for payment pending -->
      <div
        id="alert-payment"
        class="hidden bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-6"
      >
        <div class="flex items-start">
          <span class="material-symbols-outlined text-yellow-600 mr-3"
            >warning</span
          >
          <div>
            <p class="text-sm font-bold text-yellow-800 dark:text-yellow-200">
              Pago Pendiente
            </p>
            <p class="text-xs text-yellow-700 dark:text-yellow-300 mt-1">
              Tienes pagos pendientes que deben ser cubiertos antes de poder
              completar tu reinscripción.
            </p>
          </div>
        </div>
      </div>

      <!-- Validation Card -->
      <div
        class="bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl shadow-xl overflow-hidden"
      >
        <div class="p-6 sm:p-8">
          <div class="flex items-center gap-3 mb-6">
            <span class="material-symbols-outlined text-primary text-3xl"
              >person_check</span
            >
            <div>
              <h2 class="text-2xl font-black text-slate-900 dark:text-white">
                Paso 1: Validación de Datos
              </h2>
              <p class="text-slate-500 dark:text-slate-400 text-sm">
                Verifica que tu información académica actual sea correcta.
              </p>
            </div>
          </div>

          <div class="space-y-6">
            <!-- Read Only Fields Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="col-span-1">
                <label
                  class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-widest"
                  >Matrícula (No editable)</label
                >
                <div
                  class="flex items-center bg-slate-100 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg px-4 py-3 cursor-not-allowed"
                >
                  <span
                    class="material-symbols-outlined text-slate-400 mr-3 text-lg"
                    >badge</span
                  >
                  <span
                    id="matricula"
                    class="text-slate-600 dark:text-slate-300 font-bold"
                    >Cargando...</span
                  >
                </div>
              </div>

              <div class="col-span-1">
                <label
                  class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-widest"
                  >Periodo Escolar</label
                >
                <div
                  class="flex items-center bg-slate-100 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg px-4 py-3 cursor-not-allowed"
                >
                  <span
                    class="material-symbols-outlined text-slate-400 mr-3 text-lg"
                    >calendar_today</span
                  >
                  <span
                    id="periodo"
                    class="text-slate-600 dark:text-slate-300 font-bold"
                    >Cargando...</span
                  >
                </div>
              </div>

              <div class="col-span-1 md:col-span-2">
                <label
                  class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-widest"
                  >Nombre Completo</label
                >
                <div
                  class="flex items-center bg-slate-100 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg px-4 py-3 cursor-not-allowed"
                >
                  <span
                    class="material-symbols-outlined text-slate-400 mr-3 text-lg"
                    >person</span
                  >
                  <span
                    id="nombre"
                    class="text-slate-600 dark:text-slate-300 font-bold"
                    >Cargando...</span
                  >
                </div>
              </div>

              <div class="col-span-1 md:col-span-2">
                <label
                  class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-widest"
                  >Carrera / Programa Educativo</label
                >
                <div
                  class="flex items-center bg-slate-100 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg px-4 py-3 cursor-not-allowed"
                >
                  <span
                    class="material-symbols-outlined text-slate-400 mr-3 text-lg"
                    >account_tree</span
                  >
                  <span
                    id="carrera"
                    class="text-slate-600 dark:text-slate-300 font-bold"
                    >Cargando...</span
                  >
                </div>
              </div>
            </div>

            <!-- Confirmation UI -->
            <div
              class="mt-8 pt-8 border-t border-slate-100 dark:border-slate-700"
            >
              <div
                class="bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 p-6 rounded-xl flex items-start gap-4"
              >
                <div class="flex items-center h-6">
                  <input
                    class="h-5 w-5 rounded border-slate-300 text-primary focus:ring-primary"
                    id="confirm_data"
                    name="confirm_data"
                    type="checkbox"
                  />
                </div>
                <div class="text-sm">
                  <label
                    class="font-bold text-slate-900 dark:text-white block mb-1"
                    for="confirm_data"
                  >
                    Confirmación de Integridad
                  </label>
                  <p class="text-slate-500 dark:text-slate-400 leading-relaxed">
                    Declaro bajo protesta de decir verdad que los datos arriba
                    mencionados son correctos y corresponden a mi situación
                    académica actual en la institución.
                  </p>
                </div>
              </div>
            </div>

            <div
              class="flex flex-col sm:flex-row items-center justify-between gap-4 mt-8"
            >
              <button
                class="w-full sm:w-auto px-6 py-3 text-slate-600 dark:text-slate-400 font-bold text-sm hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors flex items-center justify-center gap-2"
              >
                <span class="material-symbols-outlined text-lg">report</span>
                Reportar Error en Datos
              </button>
              <a
                href="/reinscripcion/paso-2"
                class="w-full sm:w-auto bg-primary hover:bg-primary/90 text-white px-10 py-3 rounded-lg font-bold text-sm shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2"
              >
                Confirmar y Continuar
                <span class="material-symbols-outlined text-lg"
                  >arrow_forward</span
                >
              </a>
            </div>
          </div>
        </div>

        <!-- Helper footer in card -->
        <div
          class="bg-slate-50 dark:bg-slate-800/80 px-6 py-4 flex items-center gap-4 border-t border-slate-100 dark:border-slate-700"
        >
          <span class="material-symbols-outlined text-primary">info</span>
          <p class="text-xs text-slate-500 dark:text-slate-400">
            Si encuentras alguna discrepancia en tus datos, por favor acude a
            Servicios Escolares antes de continuar con tu reinscripción.
          </p>
        </div>
      </div>
    </div>
  </main>
</ReinscripcionLayout>
<script>
  // Check if user is authenticated
  const userStr = sessionStorage.getItem("user");

  if (!userStr) {
    // Redirect to login if not authenticated
    window.location.href = "/login";
  } else {
    const user = JSON.parse(userStr);

    // Display user data
    const matriculaEl = document.getElementById("matricula");
    const nombreEl = document.getElementById("nombre");
    const carreraEl = document.getElementById("carrera");
    const periodoEl = document.getElementById("periodo");
    const alertPayment = document.getElementById("alert-payment");

    if (matriculaEl) {
      matriculaEl.textContent = user.matricula || "N/A";
    }

    if (nombreEl) {
      const nombreCompleto =
        `${user.apellido_paterno || ""} ${user.apellido_materno || ""} ${user.nombre || ""}`
          .trim()
          .toUpperCase();
      nombreEl.textContent = nombreCompleto || "N/A";
    }

    if (carreraEl && user.carrera) {
      carreraEl.textContent = user.carrera.nombre || "N/A";
    }

    if (periodoEl && user.periodo) {
      periodoEl.textContent = user.periodo.nombre || "N/A";
    }

    // Show payment alert if there are pending payments
    if (alertPayment && user.tienePagosPendientes) {
      alertPayment.classList.remove("hidden");
    }
  }
</script>
